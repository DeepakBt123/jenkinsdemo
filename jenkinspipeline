pipeline {
    agent any

    stages {
                    stage('build') {
                        agent{
                            docker {
                                image 'node:18-alpine'
                                reuseNode true
                            }
                        }
                        steps {
                            sh '''
                            node --version
                            npm --version
                            npm ci
                            npm run build
                            ls -la
                            '''
                        }
                    }
           stage('test') {         
          parallel {
                    stage('juint') {
                        agent{
                            docker {
                                image 'node:18-alpine'
                            }
                        }
                        steps {
                            sh''' 
                            test -f build/index.html 
                            npm test
                            '''
                        }
                    }  
                    post {
                            always {
                            junit 'test-results/*.xml'
                            archiveArtifacts 'test-results/**'
                        }
                             }
        
                    stage('E2E') {
                        agent{
                            docker {
                                image 'mcr.microsoft.com/playwright:v1.56.1-noble'
                                reuseNode true
                            }
                        }
                        steps {
                            sh''' 
                            npm install serve  
                           node_modules/.bin/serve -s build  &
                            sleep 10
                            npx playwright test --reporte=html
                            '''
                        }
                    }
                     post {
                                always {
                                    junit 'test-results/*.xml'
                                    archiveArtifacts 'test-results/**'
                                }
                            }
                 }   
               }
              
    }
}